<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>区域车辆调度</title>
    <script src="../js/echarts.js" type="text/javascript"></script>
    <script src="../js/bmap.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="../js/angular.min.js"></script>
    <script src="../js/hefei.js" type="text/javascript"></script>
    <script type="text/javascript" src="../js/lodash.js"></script>
    <script type="text/javascript" src="../js/ng-echarts.js"></script>
    <script type="text/javascript" src="../js/getscript.js"></script>
    <script type="text/javascript" src="../js/echarts-gl.js"></script>
    <script type="text/javascript" src="../js/jquery-1.11.0.js"></script>
</head>
<body>

<div id="mapOption" style="height: 450px;width:65%;" ng-app="app" ng-controller="ctrl"></div>
<script type="text/javascript">
    var app = angular.module('app', []);
    app.controller('ctrl', function ($interval) {
        var ech = document.getElementById('mapOption');
//        var color = "rgba(0,176,0,0.8)";
        var color = "#00FFFF";
        var myChart;
        var allData;

        function init() {
            $.get("../json/dispatcherData.json", function (data) {
                allData = data;
                initMap(allData);
            });
        }

        init();

        function initMap(data) {
            myChart = echarts.init(ech);
            var option;
            option = {
                backgroundColor: '#00040C',
                legend: {
                    show: false,
                    orient: 'vertical',
                    top: 'bottom',
                    left: 'right',
                    data: ['地点', '线路'],
                    textStyle: {
                        color: '#00FFFF'
                    }
                },
                bmap: {
                    center: [117.2697910296, 31.8476722274],
//                center: [117.2710248457,31.8477451415],
                    zoom: 16,
                    roam: true,
                    mapStyle: {
                        styleJson: [
                            {
                                "featureType": "water",
                                "elementType": "all",
                                "stylers": {
                                    "color": "#031628"
                                }
                            },
                            {
                                "featureType": "land",
                                "elementType": "geometry",
                                "stylers": {
                                    "color": "#000102"
                                }
                            },
                            {
                                "featureType": "highway",
                                "elementType": "all",
                                "stylers": {
                                    "visibility": "off"
                                }
                            },
                            {
                                "featureType": "arterial",
                                "elementType": "geometry.fill",
                                "stylers": {
                                    "color": "#000000"
                                }
                            },
                            {
                                "featureType": "arterial",
                                "elementType": "geometry.stroke",
                                "stylers": {
                                    "color": "#0b3d51"
                                }
                            },
                            {
                                "featureType": "local",
                                "elementType": "geometry",
                                "stylers": {
                                    "color": "#000000"
                                }
                            },
                            {
                                "featureType": "railway",
                                "elementType": "geometry.fill",
                                "stylers": {
                                    "color": "#000000"
                                }
                            },
                            {
                                "featureType": "railway",
                                "elementType": "geometry.stroke",
                                "stylers": {
                                    "color": "#08304b"
                                }
                            },
                            {
                                "featureType": "subway",
                                "elementType": "geometry",
                                "stylers": {
                                    "lightness": -70
                                }
                            },
                            {
                                "featureType": "building",
                                "elementType": "geometry.fill",
                                "stylers": {
                                    "color": "#000000"
                                }
                            },
                            {
                                "featureType": "all",
                                "elementType": "labels.text.fill",
                                "stylers": {
                                    "color": "#857f7f"
                                }
                            },
                            {
                                "featureType": "all",
                                "elementType": "labels.text.stroke",
                                "stylers": {
                                    "color": "#000000"
                                }
                            },
                            {
                                "featureType": "building",
                                "elementType": "geometry",
                                "stylers": {
                                    "color": "#022338"
                                }
                            },
                            {
                                "featureType": "green",
                                "elementType": "geometry",
                                "stylers": {
                                    "color": "#062032"
                                }
                            },
                            {
                                "featureType": "boundary",
                                "elementType": "all",
                                "stylers": {
                                    "color": "#465b6c"
                                }
                            },
                            {
                                "featureType": "manmade",
                                "elementType": "all",
                                "stylers": {
                                    "color": "#022338"
                                }
                            },
                            {
                                "featureType": "label",
                                "elementType": "all",
                                "stylers": {
                                    "visibility": "off"
                                }
                            }
                        ]
                    }
                },
                series: [{
                    name: '地点',
                    type: 'effectScatter',
                    coordinateSystem: 'bmap',
                    zlevel: 2,
                    rippleEffect: {
                        scale: 3,
                        brushType: 'stroke'
                    },
                    label: {
                        normal: {
                            show: true,
                            position: 'right',
                            formatter: '{b}'
                        }
                    },
                    symbolSize: 1,
                    showEffectOn: 'render',
                    itemStyle: {
                        normal: {
                            color: '#46bee9'
                        }
                    },
                    data: allData.citys
                }, {
                    type: 'lines',
                    coordinateSystem: 'bmap',
                    zlevel: 1,
                    effect: {
                        show: true,
                        period: 3,
                        trailLength: 0.3,
//                    constantSpeed: 80,
//                    color: '#ED1B10',
                        color: "#00FFFF",
                        symbolSize: 5,
//                        symbol: 'image://../img/mobike.png'triangle
                        symbol: 'circle'
                    },
                    lineStyle: {
                        normal: {
//                        color: "transparent",
                            color: "#00FFFF",
                            width: 2,
                            curveness: 0.1
                        }
                    },
                    data: allData.line1
                }, {
                    type: 'lines',
                    coordinateSystem: 'bmap',
                    zlevel: 1,
                    effect: {
                        show: true,
                        period: 3,
                        trailLength: 0.3,
//                    constantSpeed: 40,
//                    color: '#ED1B10',
                        color: "#00FFFF",
                        symbolSize: 5,
//                        symbol: 'image://../img/mobike.png'triangle
                        symbol: 'circle'
                    },
                    lineStyle: {
                        normal: {
//                        color: "transparent",
                            color: "#00FFFF",
                            width: 2,
                            curveness: 0.1
                        }
                    },
                    data: allData.line2

                }

                ]
            };
            myChart.setOption(option);
            addOverlay();
        }


        // 添加信息窗口
        var backMarker1 = new BMap.Marker(new BMap.Point(117.2760735379, 31.8432697953)); // 远处点
        var backMarker2 = new BMap.Marker(new BMap.Point(117.2511475442, 31.8377418537));

        function addOverlay() {
            backMarker1.hide();
            backMarker2.hide();
            var baiduMap = myChart.getModel().getComponent('bmap').getBMap();
            var point = new BMap.Point(117.2760735379, 31.8432697953);
            var point2 = new BMap.Point(117.2511475442, 31.8377418537);

            // 添加背景框
            var myIcon = new BMap.Icon('../img/infowindow4.png', new BMap.Size(340, 130));
            var opts1 = {
                offset: new BMap.Size(-25, -155), // 设置偏移量
                icon: myIcon
            };
            var opts2 = {
                offset: new BMap.Size(160, -360), // 设置偏移量
                icon: myIcon
            };
            backMarker1 = new BMap.Marker(point, opts1);
            backMarker2 = new BMap.Marker(point2, opts2);
            baiduMap.addOverlay(backMarker1);
            baiduMap.addOverlay(backMarker2);

            // 添加信息
            var styles = {
                color: "white",
                fontSize: "16px",
                height: "25px",
                width: '260px',
                lineHeight: "25px",
                fontFamily: "微软雅黑",
                backgroundColor: '#9E3329',
                borderColor: '#9E3329'
            };

            var label1 = new BMap.Label('停放点名称:中国科学技术大学\n', {offset: new BMap.Size(0, 6)}); // 创建文本标注对象
            label1.setStyle(styles);
            backMarker1.setLabel(label1);
            var number = Math.round(Math.random() * 50 + 16);
            var label2 = new BMap.Label('需求车辆:' + number, {offset: new BMap.Size(0, 30)});
            label2.setStyle(styles);
            backMarker1.setLabel(label2);
            var label3 = new BMap.Label('停放点名称:合肥科技馆停放点\n', {offset: new BMap.Size(0, 6)}); // 创建文本标注对象
            label3.setStyle(styles);
            backMarker2.setLabel(label3);
            var number = Math.round(Math.random() * 50 + 16);
            var label4 = new BMap.Label('需求车辆:' + number, {offset: new BMap.Size(0, 30)});
            label4.setStyle(styles);
            backMarker2.setLabel(label4);
        }

        $interval(function () {
            addOverlay();
        }, 1000, 2)
    });
</script>
</body>
</html>
